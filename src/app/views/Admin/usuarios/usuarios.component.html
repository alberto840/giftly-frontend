<div class="p-[60px] flex flex-col justify-center items-center h-screen w-full bg-primary">
    <div class="w-full mb-3 flex items-center gap-1">
        <div class="text-5xl text-white font-bold">Gestión de Usuarios</div>
        <p-menu #menu [model]="items" [popup]="true" />
        <p-button (click)="menu.toggle($event)" icon="pi pi-spin pi-cog" [rounded]="true" [outlined]="true"
            severity="primary" [outlined]="true" />
    </div>
    <div class="card">
        <p-toast></p-toast>
        <p-confirmDialog [style]="{width: '450px'}"></p-confirmDialog>

        <div class="flex justify-end mb-4">
            <p-button label="Crear Usuario" icon="pi pi-plus" class="p-button-success"
                (onClick)="openNew()"></p-button>
        </div>

        <p-table class="w-full" #dt [value]="usuarios" [rows]="10" [paginator]="true" [globalFilterFields]="['nombreCompl', 'email', 'id']"
            [tableStyle]="{'min-width': '75rem'}" [rowHover]="true" dataKey="id"
            currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} entradas"
            [showCurrentPageReport]="true">

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="id" style="min-width:5rem">ID <p-sortIcon field="id"></p-sortIcon></th>
                    <th pSortableColumn="nombreCompl" style="min-width:15rem">Nombre <p-sortIcon field="nombreCompl"></p-sortIcon></th>
                    <th pSortableColumn="email" style="min-width:15rem">Email <p-sortIcon field="email"></p-sortIcon></th>
                    <th pSortableColumn="fechaNacimien" style="min-width:10rem">Fecha Nac. <p-sortIcon field="fechaNacimien"></p-sortIcon></th>
                    <th pSortableColumn="puntos" style="min-width:10rem">Puntos <p-sortIcon field="puntos"></p-sortIcon></th>
                    <th pSortableColumn="rolId" style="min-width:5rem">Rol <p-sortIcon field="rolId"></p-sortIcon></th>
                    <th>Acciones</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-usuario>
                <tr>
                    <td>{{usuario.id}}</td>
                    <td>{{usuario.nombreCompl}}</td>
                    <td>{{usuario.email}}</td>
                    <td>{{usuario.fechaNacimien | date:'dd/MM/yyyy'}}</td>
                    <td>{{usuario.puntos}}</td>
                    <td>{{usuario.rolId}}</td>
                    <td>
                        <p-button icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2"
                            (onClick)="editUsuario(usuario)"></p-button>
                        <p-button icon="pi pi-trash" class="p-button-rounded p-button-warning"
                            (onClick)="deleteUsuario(usuario)"></p-button>
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <p-dialog [(visible)]="usuarioDialog" [style]="{width: '450px'}" header="Detalles de Usuario" [modal]="true"
            styleClass="p-fluid">
            <ng-template pTemplate="content">
                <form [formGroup]="form">
                    <div class="field mb-3">
                        <label for="nombreCompl">Nombre Completo</label>
                        <input type="text" pInputText id="nombreCompl" formControlName="nombreCompl" required autofocus />
                        <small class="p-error" *ngIf="submitted && f['nombreCompl'].errors?.['required']">Nombre requerido.</small>
                    </div>
                    <div class="field mb-3">
                        <label for="email">Email</label>
                        <input type="text" pInputText id="email" formControlName="email" required />
                        <small class="p-error" *ngIf="submitted && f['email'].errors?.['required']">Email requerido.</small>
                        <small class="p-error" *ngIf="submitted && f['email'].errors?.['email']">Email inválido.</small>
                    </div>
                    <div class="field mb-3">
                        <label for="password">Contraseña</label>
                        <p-password id="password" formControlName="password" [toggleMask]="true" [feedback]="false"></p-password>
                        <small class="p-error" *ngIf="submitted && f['password'].errors?.['required']">Contraseña requerida.</small>
                        <small class="p-error" *ngIf="submitted && f['password'].errors?.['minlength']">Mínimo 6 caracteres.</small>
                    </div>
                    <div class="field mb-3">
                        <label for="fechaNacimien">Fecha de Nacimiento</label>
                        <p-calendar id="fechaNacimien" formControlName="fechaNacimien" [showIcon]="true" dateFormat="yy-mm-dd" dataType="string"></p-calendar>
                        <small class="p-error" *ngIf="submitted && f['fechaNacimien'].errors?.['required']">Fecha requerida.</small>
                    </div>
                    <div class="field mb-3">
                        <label for="puntos">Puntos</label>
                        <p-inputNumber id="puntos" formControlName="puntos" [min]="0"></p-inputNumber>
                        <small class="p-error" *ngIf="submitted && f['puntos'].errors?.['required']">Puntos requeridos.</small>
                    </div>
                    <div class="field mb-3">
                        <label for="rolId">Rol ID</label>
                        <p-inputNumber id="rolId" formControlName="rolId" [useGrouping]="false"></p-inputNumber>
                        <small class="p-error" *ngIf="submitted && f['rolId'].errors?.['required']">Rol ID requerido.</small>
                    </div>
                </form>
            </ng-template>

            <ng-template pTemplate="footer">
                <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text"
                    (click)="hideDialog()"></button>
                <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text"
                    (click)="saveUsuario()"></button>
            </ng-template>
        </p-dialog>

        <p-dialog [(visible)]="deleteUsuarioDialog" header="Confirmar" [modal]="true" [style]="{width:'450px'}">
            <div class="flex align-items-center justify-content-center">
                <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                <span *ngIf="usuario">¿Estás seguro de que quieres eliminar el usuario <b>{{usuario.nombreCompl}}</b>?</span>
            </div>
            <ng-template pTemplate="footer">
                <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No"
                    (click)="deleteUsuarioDialog = false"></button>
                <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Sí"
                    (click)="confirmDelete()"></button>
            </ng-template>
        </p-dialog>
    </div>
</div>
